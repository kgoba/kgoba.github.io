<!DOCTYPE html>
<html lang="en">
<head>
	<title>Meteosonde tracker by YL3JG</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>

	<style>
		html, body {
			height: 100%;
			margin: 0;
		}
		.leaflet-container {
			height: 400px;
			width: 600px;
			max-width: 100%;
			max-height: 100%;
		}
	</style>

	<style>body { padding: 0; margin: 0; } #map { height: 100%; width: 100vw; }</style>
</head>

<body>
    <div id='map'></div>
    <script src="js/tracker.js" type="text/javascript"></script>
    <script>
        const mapCenter = [57.00, 24.00];

        function inRange(point) {
            // return (Math.abs(point[0] - mapCenter[1]) < 20) && (Math.abs(point[1] - mapCenter[0]) < 14);
            return map.distance(mapCenter, [point[1], point[0]]) < 600000;
        }

        var map = L.map('map').setView([57.00, 24.00], 6);
        // var map = L.map('map').fitWorld();

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // 'https://api.mapbox.com/styles/v1/{username}/{style_id}/tiles/{tilesize}/{z}/{x}/{y}{@2x}'
        // L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        //     attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        //     maxZoom: 18,
        //     id: 'mapbox/outdoors-v11',
        //     tileSize: 512,
        //     zoomOffset: -1,
        //     accessToken: 'pk.eyJ1Ijoia2FybGlzZ28iLCJhIjoiY2wxa251aHg3MDJtZjNwbzZ5bXhieDAxOSJ9.CMjr3LPyI_fWDrR07tJe5Q'
        // }).addTo(map);

        // L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
        //     maxZoom: 18,
        //     attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
        //         'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        //     id: 'mapbox/streets-v11',
        //     tileSize: 512,
        //     zoomOffset: -1
        // }).addTo(map);

        map.zoomControl.setPosition('bottomright');

        L.circle([57.00, 24.00], 600*1000, { fill: false }).addTo(map);

        let scale = L.control.scale(); // Creating scale control
        scale.addTo(map); // Adding scale control to the map

        function onLocationFound(e) {
            var radius = e.accuracy / 2;

            // var locationMarker = L.marker(e.latlng).addTo(map)
            //     .bindPopup('You are within ' + radius + ' meters from this point').openPopup();

            var locationCircle = L.circle(e.latlng, radius).addTo(map);
        }

        function onLocationError(e) {
            alert(e.message);
        }

        map.on('locationfound', onLocationFound);
        map.on('locationerror', onLocationError);
        // map.locate({setView: true, maxZoom: 8});

        fetchListeners(function(name, lon, lat) {
            let marker = L.circleMarker([lat, lon], { radius: 6, fillColor: '#008000', fillOpacity: 0.6, color: '#000000', weight: 1 });
            console.log('Listener ' + name);
            marker.bindTooltip(name);
            marker.addTo(map);
        });

        fetchSites(function(name, lon, lat) {
            let marker = L.circleMarker([lat, lon], { radius: 7, fill: false, color: '#000000', weight: 3 });
            marker.bindTooltip(name);
            marker.addTo(map);
        });

        // var m1 = L.circleMarker([57.00, 24.00], { radius: 7, fill: false, color: '#000000', weight: 3 });
        // m1.addTo(map);
        // m1.setLatLng([57.00, 24.00]);
        // // m1.bindTooltip("abc");
        // m1.bindPopup("Buļļu kāpa"); // .openPopup();
    </script>
</body>
</html>
